---
title: Biên dịch và porting U-Boot cho BeagleBone Black (Phần 2)
author: kiennql
date: 2025-06-10 21:00:00 +0700
categories: [bbb-labs]
tags: [beaglebone black, embedded linux, u-boot, bootloader, cross-compile, arm]
math: true
mermaid: true
render_with_liquid: false
---

## 1. Mục lục
- [1. Mục lục](#1-mục-lục)
- [2. Kết nối Serial](#2-kết-nối-serial)
- [3. Cross-compile U-Boot](#3-cross-compile-u-boot)
- [4. Chuẩn bị thẻ SD](#4-chuẩn-bị-thẻ-sd)
- [5. Kiểm tra U-Boot](#5-kiểm-tra-u-boot)

Trong phần này, chúng ta sẽ cài đặt bootloader U-Boot lên BeagleBone Black. Bootloader là phần mềm chạy đầu tiên trên phần cứng, có nhiệm vụ khởi tạo hệ thống cơ bản và load kernel.

## 2. Kết nối Serial

Kết nối USB-to-Serial adapter với BeagleBone:
- Pin 1 (Ground) → Ground
- Pin 4 (Board Rx) → Cable Tx  
- Pin 5 (Board Tx) → Cable Rx

Cài đặt minicom và thêm user vào nhóm dialout:

```bash
sudo apt install minicom
sudo usermod -a -G dialout $USER
```

Reboot để áp dụng thay đổi nhóm dialout.

## 3. Cross-compile U-Boot

Clone và checkout U-Boot source:

```bash
git clone https://source.denx.de/u-boot/u-boot.git
cd u-boot
git checkout v2023.01
```

Thiết lập cross-compiler và build:

```bash
export CROSS_COMPILE=arm-linux-
make am335x_evm_defconfig
make DEVICE_TREE=am335x-boneblack
```

Sau khi build thành công, bạn sẽ có các file `MLO` và `u-boot.img`.

## 4. Chuẩn bị thẻ SD

Tìm device name của thẻ SD:

```bash
dmesg | tail
```

Unmount các phân vùng hiện tại:

```bash
sudo umount /dev/sda*
```

Xóa partition table và tạo phân vùng mới:

```bash
sudo dd if=/dev/zero of=/dev/sda bs=1M count=16
sudo sfdisk /dev/sda << EOF
,64M,0x0c,*
,1024M,L,
EOF
```

Tạo filesystem:

```bash
sudo mkfs.vfat -F 16 -n boot /dev/sda1
sudo mkfs.ext4 -L rootfs /dev/sda2
```

Copy U-Boot files vào thẻ SD:

```bash
cp MLO u-boot.img /media/$USER/boot/
```

## 5. Kiểm tra U-Boot

Khởi động minicom:

```bash
minicom -D /dev/ttyUSB0 -b 115200
```

Chèn thẻ SD vào BeagleBone (không cấp nguồn), giữ nút reset, cấp nguồn, sau đó thả nút.

Bạn sẽ thấy output như sau:

```
U-Boot SPL 2023.01 (Jan 21 2023 - 23:09:14 -0500)
Trying to boot from MMC1

U-Boot 2023.01 (Jan 21 2023 - 23:09:14 -0500)

CPU  : AM335X-GP rev 2.1
Model: TI AM335x BeagleBone Black
DRAM:  512 MiB
...
Hit any key to stop autoboot:  0
=> 
```

Dấu nhắc `=>` là U-Boot command line. Gõ `help` để xem các lệnh có sẵn.

**Chúc mừng!** Bạn đã thành công chạy bootloader U-Boot tự build trên BeagleBone Black.
